<!DOCTYPE html>
<html data-bs-theme="light">

<head>
    <meta charset="utf-8" />

    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="author" content="Futoshi Okazaki">
    <title>QR Code Generator</title>
    <!-- bootstrap 5.3の最新のCDNを読み込む-->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-9ndCyUaIbzAi2FUVXJi0CjmCapSmO7SnpJef0486qhLnuZ2cdeRhO02iuK6FUUVM" crossorigin="anonymous">


    <style>
        .row.qr label {
            font-size: xx-small;
        }
    </style>
</head>

<body class="bg-body-tertiary">

    <div class="container">
        <main>
            <div class="py-5 text-center">
                <h2>車検証　QRコード生成</h2>
                <p class="lead">普通車の車検証は、２分割と３分割のQRコードです。軽自動車は、分割されていません。</p>
            </div>
            <form class="needs-validation" novalidate="" action="">
                <div class="row">
                    <div class="col-md-12 mb-2">
                        <strong>普通車の分割QRコード（2）生成</strong>
                        <button type="button" id="create_type_2" class="btn btn-sm btn-primary">Create</button>
                    </div>
                </div>

                <div class="row qr">
                    <div class="col-md-12 col-lg-12">
                        <div class="row">
                            <div class="col-md-2">
                                <label for="qr2_1" class="form-label">バージョン番号</label>
                                <input type="text" class="form-control" id="qr2_1" placeholder="" maxlength="1"
                                    value="2">
                                <div class="invalid-feedback">
                                    半角固定１文字を入力してください。
                                </div>
                            </div>
                            <div class="col-md-2">
                                <label for="qr2_2" class="form-label">自動車登録番号および車両番号</label>
                                <input type="text" class="form-control" id="qr2_2" placeholder="" maxlength="12"
                                    value="山口　　３３０ほ８８９９">
                                <div class="invalid-feedback">
                                    全角固定１２文字を入力してください。
                                </div>
                            </div>
                            <div class="col-md-2">
                                <label for="qr2_3" class="form-label">標板の枚数・大きさ・希望番号の識別</label>
                                <input type="text" class="form-control" id="qr2_3" placeholder="" maxlength="1"
                                    value="A">
                                <div class="invalid-feedback">
                                    半角固定１文字を入力してください。
                                </div>
                            </div>
                            <div class="col-md-2">
                                <label for="qr2_4" class="form-label">車台番号</label>
                                <input type="text" class="form-control" id="qr2_4" placeholder="" maxlength="23"
                                    value="GRS210-6021369">
                                <div class="invalid-feedback">
                                    半角可変２３文字を入力してください。
                                </div>
                            </div>
                            <div class="col-md-2">
                                <label for="qr2_5" class="form-label">原動機型式</label>
                                <input type="text" class="form-control" id="qr2_5" placeholder="" maxlength="24"
                                    value="4GR">
                                <div class="invalid-feedback">
                                    半角可変２４文字を入力してください。
                                </div>
                            </div>
                            <div class="col-md-2">
                                <label for="qr2_6" class="form-label">帳票種別</label>
                                <input type="text" class="form-control" id="qr2_6" placeholder="" maxlength="1"
                                    value="1">
                                <div class="invalid-feedback">
                                    半角固定１文字を入力してください。
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-12 mb-2 mt-2">
                        <strong>普通車の分割QRコード（3）生成</strong>
                        <button type="button" id="create_type_3" class="btn btn-sm btn-primary">Create</button>
                    </div>
                </div>
                <div class="row qr">
                    <div class="col-md-12 col-lg-12">
                        <div class="row">
                            <div class="col-md-2">
                                <label for="qr3_1" class="form-label">バージョン番号</label>
                                <input type="text" class="form-control" id="qr3_1" placeholder="" maxlength="1"
                                    value="2">
                                <div class="invalid-feedback">
                                    半角固定１文字を入力してください。
                                </div>
                            </div>
                            <div class="col-md-2">
                                <label for="qr3_2" class="form-label">車台番号打刻位置</label>
                                <input type="text" class="form-control" id="qr3_2" placeholder="" maxlength="3"
                                    value="-  ">
                                <div class="invalid-feedback">
                                    半角固定３文字を入力してください。
                                </div>
                            </div>
                            <div class="col-md-2">
                                <label for="qr3_3" class="form-label">型式指定番号・類別区分番号</label>
                                <input type="text" class="form-control" id="qr3_3" placeholder="" maxlength="10"
                                    value="174900040">
                                <div class="invalid-feedback">
                                    半角可変１０文字を入力してください。
                                </div>
                            </div>
                            <div class="col-md-2">
                                <label for="qr3_4" class="form-label">有効期間の満了する日</label>
                                <input type="text" class="form-control" id="qr3_4" placeholder="" maxlength="6"
                                    value="240530">
                                <div class="invalid-feedback">
                                    半角固定６文字を入力してください。
                                </div>
                            </div>
                            <div class="col-md-2">
                                <label for="qr3_7" class="form-label">初度登録年月</label>
                                <input type="text" class="form-control" id="qr3_7" placeholder="" maxlength="4"
                                    value="1705">
                                <div class="invalid-feedback">
                                    半角固定4文字を入力してください。
                                </div>
                            </div>
                            <div class="col-md-2">
                                <label for="qr3_8" class="form-label">形式</label>
                                <input type="text" class="form-control" id="qr3_8" placeholder="" maxlength="17"
                                    value="DBA-GRS210">
                                <div class="invalid-feedback">
                                    半角可変１７文字を入力してください。
                                </div>
                            </div>
                            <div class="col-md-2">
                                <label for="qr3_9" class="form-label">軸重（前前）</label>
                                <input type="text" class="form-control" id="qr3_9" placeholder="" maxlength="4"
                                    value="0084">
                                <div class="invalid-feedback">
                                    半角固定４文字を入力してください。
                                </div>
                            </div>
                            <div class="col-md-2">
                                <label for="qr3_10" class="form-label">軸重（前後）</label>
                                <input type="text" class="form-control" id="qr3_10" placeholder="" maxlength="4"
                                    value="-   ">
                                <div class="invalid-feedback">
                                    半角固定４文字を入力してください。
                                </div>
                            </div>
                            <div class="col-md-2">
                                <label for="qr3_11" class="form-label">軸重（後前）</label>
                                <input type="text" class="form-control" id="qr3_11" placeholder="" maxlength="4"
                                    value="-   ">
                                <div class="invalid-feedback">
                                    半角固定４文字を入力してください。
                                </div>
                            </div>
                            <div class="col-md-2">
                                <label for="qr3_12" class="form-label">軸重（後後）</label>
                                <input type="text" class="form-control" id="qr3_12" placeholder="" maxlength="4"
                                    value="0075">
                                <div class="invalid-feedback">
                                    半角固定４文字を入力してください。
                                </div>
                            </div>
                            <div class="col-md-2">
                                <label for="qr3_13" class="form-label">騒音規制</label>
                                <input type="text" class="form-control" id="qr3_13" placeholder="" maxlength="2"
                                    value="10">
                                <div class="invalid-feedback">
                                    半角固定２文字を入力してください。
                                </div>
                            </div>
                            <div class="col-md-2">
                                <label for="qr3_14" class="form-label">近接排気騒音規制値</label>
                                <input type="text" class="form-control" id="qr3_14" placeholder="" maxlength="3"
                                    value="096">
                                <div class="invalid-feedback">
                                    半角固定３文字を入力してください。
                                </div>
                            </div>
                            <div class="col-md-2">
                                <label for="qr3_15" class="form-label">駆動方式</label>
                                <input type="text" class="form-control" id="qr3_15" placeholder="" maxlength="1"
                                    value="2">
                                <div class="invalid-feedback">
                                    半角固定１文字を入力してください。
                                </div>
                            </div>
                            <div class="col-md-2">
                                <label for="qr3_16" class="form-label">オパシメータ測定車</label>
                                <input type="text" class="form-control" id="qr3_16" placeholder="" maxlength="1"
                                    value="0">
                                <div class="invalid-feedback">
                                    半角固定１文字を入力してください。
                                </div>
                            </div>
                            <div class="col-md-2">
                                <label for="qr3_17" class="form-label">NOx・PM測定モード</label>
                                <input type="text" class="form-control" id="qr3_17" placeholder="" maxlength="1"
                                    value="I">
                                <div class="invalid-feedback">
                                    半角固定１文字を入力してください。
                                </div>
                            </div>
                            <div class="col-md-2">
                                <label for="qr3_18" class="form-label">NOx値</label>
                                <input type="text" class="form-control" id="qr3_18" placeholder="" maxlength="4"
                                    value="0001">
                                <div class="invalid-feedback">
                                    半角固定4文字を入力してください。
                                </div>
                            </div>
                            <div class="col-md-2">
                                <label for="qr3_19" class="form-label">PM値</label>
                                <input type="text" class="form-control" id="qr3_19" placeholder="" maxlength="5"
                                    value="-    ">
                                <div class="invalid-feedback">
                                    半角固定5文字を入力してください。
                                </div>
                            </div>
                            <div class="col-md-2">
                                <label for="qr3_20" class="form-label">保安基準適用年月日</label>
                                <input type="text" class="form-control" id="qr3_20" placeholder="" maxlength="6"
                                    value="170512">
                                <div class="invalid-feedback">
                                    半角固定6文字を入力してください。
                                </div>
                            </div>
                            <div class="col-md-2">
                                <label for="qr3_21" class="form-label">燃料の種類コード</label>
                                <input type="text" class="form-control" id="qr3_21" placeholder="" maxlength="2"
                                    value="01">
                                <div class="invalid-feedback">
                                    半角固定2文字を入力してください。
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <hr>
                <div class="row g-5">
                    <div class="col-md-12 col-lg-12">
                        <div class="row g-3">
                            <div class="col-md-2">
                                <label for="total_page2" class="form-label">分割数</label>
                                <input type="number" class="form-control text-end" id="total_page2" placeholder=""
                                    value="2" required="">
                                <div class="invalid-feedback">
                                    数字を入力してください。
                                </div>
                            </div>
                            <div class="col-md-10">
                                <label for="qr_text2" class="form-label">車検証QRデータ</label>
                                <input type="text" class="form-control" id="qr_text2" placeholder=""
                                    value="2/山口　　３３０ほ８８９９/A/GRS210-6021369/4GR/1" required="">
                            </div>
                        </div>

                        <div class="row g-3">
                            <div class="col-md-2">
                                <label for="total_page3" class="form-label">分割数</label>
                                <input type="number" class="form-control text-end" id="total_page3" placeholder=""
                                    value="3" required="">
                                <div class="invalid-feedback">
                                    数字を入力してください。
                                </div>
                            </div>
                            <div class="col-md-10">
                                <label for="qr_text3" class="form-label">車検証QRデータ</label>
                                <input type="text" class="form-control" id="qr_text3" placeholder=""
                                    value="2/-  /174900040/240530/1705/DBA-GRS210/0084/-   /-   /0075/10/096/2/0/I/0001/-    /170512/01"
                                    required="">
                            </div>
                        </div>
                        <hr class="my-4">

                        <button class="w-100 btn btn-primary btn-lg" type="button" id="write">QRコード生成</button>
                    </div>
                </div>
            </form>

            <!-- 分割総数をセットするテキストボックス-->
            <div class="row">
                <div class="col-sm-12">
                    <span id="write-svg3"></span><span class="p-3"></span><span id="write-svg2"></span>
                </div>
            </div>
        </main>
    </div>




    </div>
    <footer class="my-5 pt-5 text-body-secondary text-center text-small">
        <p class="mb-1">QRコードはデンソーウェーブの登録商標です</p>
        <ul class="list-inline">
            <!-- <li class="list-inline-item"><a href="#">Privacy</a></li>
          <li class="list-inline-item"><a href="#">Terms</a></li>
          <li class="list-inline-item"><a href="#">Support</a></li> -->
        </ul>
    </footer>


    <!-- bootstrap のJSを読み込む-->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-geWF76RCwLtnZ8qwWowPQNguL3RmwHVBC9FhGdlKrxdiJJigb/j/68SIy3Te4Bkz"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js"
        integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.min.js"
        integrity="sha384-fbbOQedDUMZZ5KreZpsbe1LCZPVmfTnH7ois6mU1QK+m14rQ1l2bGBq41eYeM/fS"
        crossorigin="anonymous"></script>

    <!-- ここからQRコードのライブラリを読み込む-->
    <script type="text/javascript" src="zxing.js"></script>
    <script type="text/javascript" src="lib.js"></script>

    <script type="text/javascript">

        window.addEventListener('load', function () {
            // create2ボタンを押したときの処理

            document.getElementById('create_type_2').addEventListener('click', function (e) {
                const qr_text2 = document.getElementById('qr_text2');
                const qr2_1 = document.getElementById('qr2_1');
                const qr2_2 = document.getElementById('qr2_2');
                const qr2_3 = document.getElementById('qr2_3');
                const qr2_4 = document.getElementById('qr2_4');
                const qr2_5 = document.getElementById('qr2_5');
                const qr2_6 = document.getElementById('qr2_6');

                qr_text2.value = qr2_1.value + '/' + qr2_2.value + '/' + qr2_3.value + '/' + qr2_4.value + '/' + qr2_5.value + '/' + qr2_6.value;
            });

            // create3ボタンを押したときの処理 qr_text3にqr3_1からqr3_21までを'/'で連結して qr_text3に値をセットする
            document.getElementById('create_type_3').addEventListener('click', function (e) {
                const qr_text3 = document.getElementById('qr_text3');
                const qr3_1 = document.getElementById('qr3_1');
                const qr3_2 = document.getElementById('qr3_2');
                const qr3_3 = document.getElementById('qr3_3');
                const qr3_4 = document.getElementById('qr3_4');
                const qr3_7 = document.getElementById('qr3_7');
                const qr3_8 = document.getElementById('qr3_8');
                const qr3_9 = document.getElementById('qr3_9');
                const qr3_10 = document.getElementById('qr3_10');
                const qr3_11 = document.getElementById('qr3_11');
                const qr3_12 = document.getElementById('qr3_12');
                const qr3_13 = document.getElementById('qr3_13');
                const qr3_14 = document.getElementById('qr3_14');
                const qr3_15 = document.getElementById('qr3_15');
                const qr3_16 = document.getElementById('qr3_16');
                const qr3_17 = document.getElementById('qr3_17');
                const qr3_18 = document.getElementById('qr3_18');
                const qr3_19 = document.getElementById('qr3_19');
                const qr3_20 = document.getElementById('qr3_20');
                const qr3_21 = document.getElementById('qr3_21');

                qr_text3.value = qr3_1.value + '/' + qr3_2.value + '/' + qr3_3.value + '/' + qr3_4.value + '/' + qr3_7.value + '/' + qr3_8.value + '/' + qr3_9.value + '/' + qr3_10.value + '/' + qr3_11.value + '/' + qr3_12.value + '/' + qr3_13.value + '/' + qr3_14.value + '/' + qr3_15.value + '/' + qr3_16.value + '/' + qr3_17.value + '/' + qr3_18.value + '/' + qr3_19.value + '/' + qr3_20.value + '/' + qr3_21.value;
            });




            // 生成
            document.getElementById('write').addEventListener('click', function (e) {
                const writeSvg2 = document.getElementById('write-svg2');
                const writeSvg3 = document.getElementById('write-svg3');
                writeSvg2.innerHTML = '';
                writeSvg3.innerHTML = '';

                const total_page2 = document.getElementById('total_page2').value;
                const total_page3 = document.getElementById('total_page3').value;

                const writer = new ZXing.BrowserQRCodeSvgWriter();
                const qr_text2 = document.getElementById('qr_text2').value;
                const qr_text3 = document.getElementById('qr_text3').value;

                // utf-8文字列を分割する
                const qr_text2_array = splitUtf8String(qr_text2, total_page2);
                const qr_text3_array = splitUtf8String(qr_text3, total_page3);

                const hints = new Map();
                // MARGINの設定
                //hints.set(ZXing.EncodeHintType.MARGIN, 3);
                // QRコードのエラー訂正レベルの設定
                hints.set(ZXing.EncodeHintType.ERROR_CORRECTION, "M");
                // QRコードのバージョンの設定
                hints.set(ZXing.EncodeHintType.QR_VERSION, 3);
                
                for (let i = 0; i < total_page2; i++) {
                    const svg = writer.write_sa(i, total_page2, 2, qr_text2_array[i], 128, 128, hints);
                    writeSvg2.appendChild(svg);
                }
                for (let i = 0; i < total_page3; i++) {
                    const svg = writer.write_sa(i, total_page3, 3, qr_text3_array[i], 128, 128, hints);
                    writeSvg3.appendChild(svg);
                }
            });
        });
    </script>
</body>


</html>