<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8"/>


        <!-- bootstrap のCDNを読み込む-->
        <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
        <!-- bootstrap のJSを読み込む-->
        <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"></script>
        <!-- bootstrap のJSを読み込む-->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
        <!-- bootstrap のJSを読み込む-->
        <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>
        <!-- ここからQRコードのライブラリを読み込む-->

        <script type="text/javascript" src="node_modules/@zxing/library/umd/index.js"></script>

        <script type="text/javascript">

          window.addEventListener('load', function() {


            // 生成
            document.getElementById('write').addEventListener('click', function(e) {
                const writeSvg = document.getElementById('write-svg');

                const total_page = document.getElementById('total_page').value;
                
                const writer = new ZXing.BrowserQRCodeSvgWriter();
                const qr_text = document.getElementById('qr_text').value;

                // qr_textをtotal_pageで指定した数に分割する。ただし、qr_textの文字数はバイトで計算する
                // qr_textのバイト数を取得する
                //const qr_text_byte = encodeURI(qr_text).replace(/%../g, '*').length;

                const qr_text_array = qr_text.match(new RegExp('.{1,' + Math.ceil(qr_text.length / total_page) + '}', 'g'));


                

                for(let i = 0 ; i < total_page; i++ ){
                    const svg = writer.write_sa(i, total_page-1, 1, qr_text_array[i], 256, 256);
                    writeSvg.appendChild(svg);
                }
            });
        });
        </script>
    </head>
    <body> 


        <h2>分割QRコード（車検証QRコード）生成</h2>
        <!-- bootstrap form -->


        <div class="form-group">

            <!-- 分割総数をセットするテキストボックス-->
            <label for="total_page">分割総数</label>
            <input type="number" class="form-control" id="total_page" value="3" style="width:50px">
          <input type="text" class="form-control" id="qr_text" value="車検証QRを読み込んだデータ" style="width: 400px;">
        <button class="btn btn-primary" id="write">write</button>
        <div id="write-svg"></div>
        </div>
    </body>
</html>